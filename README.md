# КруБИС

Проект собирается в среде **Node.js**. Скрипты карты написаны на **TypeScript**, разметка **HTML** для
карты формируется из шаблонов Embedded JavaScript (**EJS**). Для удобства шаблоны **EJS** размещены в папках
с модулями **TypeScript**, к которым они относятся. Но фактически сборка **HTML** и **JavaScript** происходят
независимо друг от друга. Стили **CSS** для сборки подключаются в модулях **TypeScript**, а не в **HTML**.

Для упрощения работы с разными подложками карт в проекте использована библиотека **Leaflet**.

## Установка и сборка

После развёртывания репозитория нужно установить необходимые пакеты с помощью

```bash
npm install
```

Сборка для локального тестирования и отладки выполняется командой

```bash
npm run build:dev
```

Файлы проекта собираются в папке `dist`, далее их можно запускать с помощью любого статического веб-сервера.
Для корректной работы API необходимо, чтобы на сервере основного сайта были разрешены **Cross-Origin** запросы.
Для работы в боевом режиме этого не требуется.

Для сборки документации используется **JSDoc**, сборка запускается командой

```bash
npm run build:doc
```
Документация собирается в папку `docs`.

## Интеграция на сайт

Для соответствия сайту были скопированы стили из `https://krubiss.ru/local/templates/krubis/css/main.css` и
помещены в файл `site-globals.css`. В случае изменения стилей на сайте рекомендуется перед началом работы с картой
обновить этот файл. В основном карта имеет собственную стилизацию, тем не менее некоторые глобальные стили используются.

Сборка для сайта выполняется командой

```bash
npm run build
```

Сборка производится также в папку `dist`, при этом собирается минимальный необходимый набор файлов. Вместо файла
`site-globals.css` подключаются стили из исходного файла `https://krubiss.ru/local/templates/krubis/css/main.css`.
Вместо `index.html` формируется файл `map.html`. Собранные файлы готовы к размещению на сервере в папке `/map`.
